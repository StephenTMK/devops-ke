---
# Controller config: make provider controllers talk to LocalStack
apiVersion: pkg.crossplane.io/v1alpha1
kind: ControllerConfig
metadata:
  name: aws-localstack-cc
  namespace: crossplane-system
spec:
  env:
    - name: AWS_REGION
      value: us-east-1
    - name: AWS_ENDPOINT_URL
      value: http://localstack.localstack.svc.cluster.local:4566
    - name: AWS_S3_USE_PATH_STYLE
      value: "true"
---
# Family provider – shared types/infra for AWS
apiVersion: pkg.crossplane.io/v1
kind: Provider
metadata:
  name: upbound-provider-family-aws
  namespace: crossplane-system
spec:
  package: xpkg.upbound.io/upbound/provider-family-aws:v0.40.0
  controllerConfigRef:
    name: aws-localstack-cc
---
# S3 provider – installs s3.aws.upbound.io CRDs/controllers
apiVersion: pkg.crossplane.io/v1
kind: Provider
metadata:
  name: provider-aws-s3
  namespace: crossplane-system
spec:
  package: xpkg.upbound.io/upbound/provider-aws-s3:v0.40.0
  controllerConfigRef:
    name: aws-localstack-cc
